---
title: "Water Footprint Nutritional Efficiency"
author: "Stephen Franklin"
date: "May 2, 2015"
output: html_document
license: <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/InteractiveResource" property="dct:title" rel="dct:type">Water Footprint Nutritional Efficiency</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http:\\stephenfranklin.info" property="cc:attributionName" rel="cc:attributionURL">Stephen Franklin</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="http://waterfootprint.org/en/resources/water-footprint-statistics/" rel="dct:source">http://waterfootprint.org/en/resources/water-footprint-statistics/</a>.<br />Permissions beyond the scope of this license may be available at <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.ars.usda.gov/Services/docs.htm?docid=8964" rel="cc:morePermissions">http://www.ars.usda.gov/Services/docs.htm?docid=8964</a>.

---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
summary(cars)
```

You can also embed plots, for example:

```{r, echo=FALSE}
plot(cars)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.




#### Conversions:
#### 1000 cubic meters / metric ton
#### = 120 gallons / pound
#### = 26.4 gallons / 100 grams  
#### ~or~ 4000 m3/t = 100 gal / 100 g

## 1/2 lb hamburger: 14000 m3/t = 14*120/2 = 840 gallons
## 1/2 lb almonds:   13000 m3/t = 13*120/2 = 780 gallons

### Conversion factors ###
# cf.m3_t.L_100g    <- 0.1      ## cubic meters per metric ton to Liters per 100 grams.
# cf.m3_t.gal_100g  <- .026     ## m^3 per m.ton to US liquid gallons per 100 grams. 
# cf.m3_t.gal_oz    <- .007489  ## m^3/m.ton to US liq gallons per avoirdupois ounces.



#### Animal data -- import data ####

## Each country column comprises four columns for four Production systems:
## Grazing    Mixed    Industrial	Weighted average.
## We want just the weighted averages 
## for the United States and the World Average.

## There's some non-food products which we should eliminate, 
##          e.g. Semen bovine 1064393    1142704.
animal_cg[,food:=logical(.N)]
## Some key words for non-food / food are:
## live, waste, semen, hair, skin, hide, bend, leather
## carcass, cut, meat, edible, fresh, frozen, prepar, preserv, process, dried

# Products
# 1:  Milk not concentrated & unsweetened exceeding 1% not exceeding 6% fat
# 2: Yogurt concentratd o not,sweetend o not,flavourd o contg fruit o cocoa
# 3:                                           Milk and cream nes sweetened
# 4:                       Eggs, bird, in shell, fresh, preserved or cooked
# 5: Dom fowl,duck,goose&guinea fowl meat&meat offal prep/presvd exc livers
# 6:                                                             Cheese nes
# 7:                                    Goat meat, fresh, chilled or frozen
# 8:                                                                 Butter
# 9:                                      Swine cuts, fresh or chilled, nes
# 10:                                 Sheep cuts, boneless, fresh or chilled
# 11:                                 Bovine cuts boneless, fresh or chilled

##!! Notes:
## I chose the meats that were described as fresh and boneless.
## Excluded meats that were offal, liver, or preserved.
## Excluded animal_ed[65] as an outlier, though a remarkable one.
##  Horse, ass, mule or hinny meat, fresh, chilled or frozen    47317    51779
##  Bovine meat cured    21909	23799
## Also: why no fish?

##!! Initial observation is that high protein products use the most water.


#quantile(animal_s$mass)
    ### The mass should be close to 100,
    ### as the nutrients are measured in grams per 100 grams of product.

### USDA plant data ####
## These plants aren't *easily* grepped in a function,
## mostly because the study's names are not similar to the USDA's names.
## e.g. "aubergines(egg-plants)" vs. "eggplants"
## Or because the products themselves weren't easy to match.
## e.g. sugar, coffee, cocoa, and tea are all plants;
## the USDA lists them as many diverse products, but not as raw plants.
## *!*!* Also, what does "nes" mean? ... I'm going with "not explicitly stated".

## ... that was kind of a waste of effort for only 9 extra observations; that's what I get for trying to be overly inclusive.




    




#### Tables and plots ####

setkey(water,protein)
rm(California_footprint, Global_avg_footprint, Products, protein)
attach(water)

qplot(water, x=water$California_footprint,y=water$protein,
      color = water$kingdom)
qplot(water, x=water$Global_avg_footprint,y=water$protein,
      col = water$kingdom)


par(mfrow = c(1,1))
pairs(water[,c(2,3,4,5,8,9),with=F], panel = panel.smooth, 
      main = "water footprint data", 
      col = 2 + (as.numeric(water$kingdom) < 2)) ## color: red=2,green=3, plant=1,animal=2
cor(water$protein,water$California_footprint)

wfit0 <- lm(Global_avg_footprint ~ protein, water)
summary(wfit0)$r.squared
summary(wfit0)$coefficients

### Global_avg: We would expect a 390 m3/ton increase in the footprint for each 1 gram increase in protein.
### The amount of protein in the food explains 61% of the variance in the data.
### This makes sense because protein synthesis requires water.
### https://www.youtube.com/watch?v=H8WJ2KENlK0&index=3&list=PL3EED4C1D684D3ADF
### https://www.youtube.com/watch?v=itsb2SqR-R0&index=11&list=PL3EED4C1D684D3ADF
### CA: 450 m3/ton increase. r2 is 52%.

### Do animal-based foods have a bigger water footprint than plant-based foods?
wfit1 <- lm(Global_avg_footprint ~ as.numeric(kingdom), water)
summary(wfit1)$r.squared
summary(wfit1)$coefficients
### Well, it seems (p-value = 0.01) 
### there is a somewhat significant increase in the water footprint of 
### animal-based foods over plant-based foods.
### But it only explains 13% of the variance.

### Holding protein constant:
wfit2 <- lm(Global_avg_footprint ~ kingdom + protein, water)
summary(wfit2)$r.squared
summary(wfit2)$coefficients
### It seems protein content is very important in predicting water footprint.

## Examining the interaction between kingdom and protein
wfit3 <- lm(Global_avg_footprint ~ protein * kingdom, water)
summary(wfit3)$r.squared
summary(wfit3)$coefficients
### The reference category for `kingdom` is "1" -- plants, 
### which has and intercept of 155 m3/ton. 
### The slope for *animals* is 416. 
### The change in intercept for *animals* is 1685.
### And the change in slope for *animals* is -125.

### The interaction isn't significant (p: 0.3 > 0.05)

### Let's plot the regression lines for animal versus plant sources,
### with protein as an interaction:
par(mfrow = c(1,1))
plot(protein,Global_avg_footprint,pch=19)
points(protein,Global_avg_footprint,pch=19,col=((as.numeric(kingdom)<2)*1+2))
## Again, the as.numeric() turns the factor "0" into a 1
## and the factor "1" into a 2.
abline(c(wfit3$coeff[1],wfit3$coeff[2]),col="green",lwd=3)
abline(c(wfit3$coeff[1] + wfit3$coeff[3],wfit3$coeff[2] +wfit3$coeff[4]),col="red",lwd=3)
### The two food sources seem closely correlated, and that agrees
### with the interaction being insignificant.

### But let's check the residuals
par(mfrow = c(1,1))
ew <- wfit3$residuals 
plot(kingdom, ew,
     xlab = "kingdom (0=plant)",
     ylab = "Residuals")

### compared to fit2
par(mfrow = c(1,1))
ew <- wfit2$residuals 
plot(kingdom, ew,
     xlab = "kingdom (0=plant)",
     ylab = "Residuals")
### Very similar. Lots of outliers in plants.

## resdiuals and leverage
par(mfrow = c(2, 2))
plot(wfit3)
### Three products -- beef, butter, almonds -- have significant leverage in the model. 

### Let's see the model without them:
par(mfrow = c(1,1))
plot(protein[c(-12,-45,-46)],Global_avg_footprint[c(-12,-45,-46)],pch=19)
points(protein[c(-12,-45,-46)],Global_avg_footprint[c(-12,-45,-46)],pch=19,col=((as.numeric(kingdom[c(-12,-45,-46)])<2)*1+2))
abline(c(wfit3$coeff[1],wfit3$coeff[2]),col="green",lwd=3)
abline(c(wfit3$coeff[1] + wfit3$coeff[3],wfit3$coeff[2] +wfit3$coeff[4]),col="red",lwd=3)
### Pretty much the same.

### Analysis of variance to compare the three models:
anova(wfit0, wfit1, wfit2, wfit3)
#### anova shows that wfit2 
#### (predicting the footprint by kingdom holding protein constant)
#### is the best model.

###  
library(MASS)
wfit.s <- stepAIC(lm(Global_avg_footprint ~ ., data = water[,c(3,4,5),with=F]), trace = 0) 
summary(fit.s)$coeff




#### The USDA numbers and descriptions of foods are different
#### than the water footprint data.

### e.g. USDA doesn't have "bovine", and a search for "beef"
### yields 1154 results with a variety of protein content.
### "beef ground" yield 49 choices.
### Perhaps the best choice is: 
### "name": "Beef, ground, unspecified fat content, cooked",
### "ndbno": "23220"  (about 25 g protein)
### But "beef chuck" which yields 179 choices of higher protein values (up to 36 g).

